<?xml version="1.0" encoding="UTF-8" ?>
<NMSMPipelineDocument Version="1.0.0">
    <DesignOptimizationTool>
        <!--Directory used for writing results.-->
        <results_directory>resultsSD_fft</results_directory>
        <!--Directory for input files-->
		<data_directory>preprocessed</data_directory>
        <!--Name of the input model file (.osim) to use-->
        <input_model_file>RightLegAndPelvisKneeNoAdd.osim</input_model_file>
    	<!--*Optional* Name of the initial states guess file-->
    	<initial_states_file>C:\Users\ma86\Documents\GitHub\nmsm-tutorial\Step-9-New-Design-Optimization\InitialGuess\resultsSD\statesSolution.sto</initial_states_file>
		<!--*Optional* Name of the initial controls guess file-->
		<initial_controls_file>C:\Users\ma86\Documents\GitHub\nmsm-tutorial\Step-9-New-Design-Optimization\InitialGuess\resultsSD\controlSolution.sto</initial_controls_file> 
		<synergy_vectors_file>C:\Users\ma86\Documents\GitHub\nmsm-tutorial\Step-9-New-Design-Optimization\InitialGuess\resultsSD\parameterSolution.sto</synergy_vectors_file>
    	<!--Indicate the name of the type of controller: synergy driven or torque driven-->
    	<type_of_controller>synergy_driven</type_of_controller>
    	<!--Indicate if synergy vectors should be optimized-->
    	<optimize_synergy_vectors>false</optimize_synergy_vectors>
    	<!--Name of the osimx model file-->
    	<osimx_file />
		<model_functions></model_functions>
		<!--Indicate the surrogate model coordinates-->
    	<coordinate_list>hip_flexion_r hip_adduction_r hip_rotation_r knee_angle_r ankle_angle_r subtalar_angle_r</coordinate_list>
		<!--Name of the surrogate model coefficients file-->
    	<surrogate_model_coefficients>coefficients.mat</surrogate_model_coefficients>
		<RCNLParameterTermSet></RCNLParameterTermSet>
		<!--Name of optimal controls setting file-->
		<optimal_control_settings_file>gpopsSettings.xml</optimal_control_settings_file>
		<RCNLSynergySet>
			<RCNLSynergy>
				<muscle_group_name>RightLeg</muscle_group_name>
				<num_synergies>3</num_synergies>
			</RCNLSynergy>
    	</RCNLSynergySet>
    	<!--Design variable bounds-->
    	<RCNLDesignVariableBoundsTerms>
    		<joint_positions_multiple>2</joint_positions_multiple>
    		<joint_velocities_multiple>1.5</joint_velocities_multiple>
    		<joint_accelerations_multiple>1</joint_accelerations_multiple>
    		<joint_jerks_multiple>1</joint_jerks_multiple>
    		<synergy_activations_max>2</synergy_activations_max>
    		<synergy_weights_max>1</synergy_weights_max>
			<final_time_range>0.15</final_time_range>
    	</RCNLDesignVariableBoundsTerms>
		<RCNLCostTermSet>
			<RCNLCostTerm>
				<type>user_defined</type>
				<function_name>footSpeedCost</function_name>
				<cost_term_type>discrete</cost_term_type>
				<is_enabled>true</is_enabled>
				<marker_name>R_Midfoot_Superior</marker_name>
				<initial_speed>10</initial_speed>
				<max_allowable_error>5</max_allowable_error>
			</RCNLCostTerm>
			<RCNLCostTerm>
				<type>coordinate_tracking</type>
				<coordinate>pelvis_tilt</coordinate>
				<is_enabled>true</is_enabled>
				<max_allowable_error>0.75</max_allowable_error>
			</RCNLCostTerm>
			<RCNLCostTerm>
				<type>coordinate_tracking</type>
				<coordinate>pelvis_list</coordinate>
				<is_enabled>true</is_enabled>
				<max_allowable_error>0.75</max_allowable_error>
			</RCNLCostTerm>
			<RCNLCostTerm>
				<type>coordinate_tracking</type>
				<coordinate>pelvis_rotation</coordinate>
				<is_enabled>true</is_enabled>
				<max_allowable_error>0.75</max_allowable_error>
			</RCNLCostTerm>
			<RCNLCostTerm>
				<type>coordinate_tracking</type>
				<coordinate>pelvis_tx</coordinate>
				<is_enabled>true</is_enabled>
				<max_allowable_error>0.1</max_allowable_error>
			</RCNLCostTerm>
			<RCNLCostTerm>
				<type>coordinate_tracking</type>
				<coordinate>pelvis_ty</coordinate>
				<is_enabled>true</is_enabled>
				<max_allowable_error>0.1</max_allowable_error>
			</RCNLCostTerm>
			<RCNLCostTerm>
				<type>coordinate_tracking</type>
				<coordinate>pelvis_tz</coordinate>
				<is_enabled>true</is_enabled>
				<max_allowable_error>0.1</max_allowable_error>
			</RCNLCostTerm>
			<RCNLCostTerm>
				<type>coordinate_tracking</type>
				<coordinate>hip_flexion_r</coordinate>
				<is_enabled>true</is_enabled>
				<max_allowable_error>0.75</max_allowable_error>
			</RCNLCostTerm>
			<RCNLCostTerm>
				<type>coordinate_tracking</type>
				<coordinate>hip_adduction_r</coordinate>
				<is_enabled>true</is_enabled>
				<max_allowable_error>0.75</max_allowable_error>
			</RCNLCostTerm>
			<RCNLCostTerm>
				<type>coordinate_tracking</type>
				<coordinate>hip_rotation_r</coordinate>
				<is_enabled>true</is_enabled>
				<max_allowable_error>0.75</max_allowable_error>
			</RCNLCostTerm>
			<RCNLCostTerm>
				<type>coordinate_tracking</type>
				<coordinate>knee_angle_r</coordinate>
				<is_enabled>true</is_enabled>
				<max_allowable_error>0.75</max_allowable_error>
			</RCNLCostTerm>
			<RCNLCostTerm>
				<type>coordinate_tracking</type>
				<coordinate>ankle_angle_r</coordinate>
				<is_enabled>true</is_enabled>
				<max_allowable_error>0.75</max_allowable_error>
			</RCNLCostTerm>
			<RCNLCostTerm>
				<type>coordinate_tracking</type>
				<coordinate>subtalar_angle_r</coordinate>
				<is_enabled>true</is_enabled>
				<max_allowable_error>0.75</max_allowable_error>
			</RCNLCostTerm>
			<RCNLCostTerm>
				<type>coordinate_tracking</type>
				<coordinate>mtp_angle_r</coordinate>
				<is_enabled>true</is_enabled>
				<max_allowable_error>0.75</max_allowable_error>
			</RCNLCostTerm>
			<RCNLCostTerm>
				<type>joint_jerk_minimization</type>
				<coordinate>pelvis_tilt</coordinate>
				<is_enabled>true</is_enabled>
				<max_allowable_error>1000</max_allowable_error>
			</RCNLCostTerm>
			<RCNLCostTerm>
				<type>joint_jerk_minimization</type>
				<coordinate>pelvis_list</coordinate>
				<is_enabled>true</is_enabled>
				<max_allowable_error>1000</max_allowable_error>
			</RCNLCostTerm>
			<RCNLCostTerm>
				<type>joint_jerk_minimization</type>
				<coordinate>pelvis_rotation</coordinate>
				<is_enabled>true</is_enabled>
				<max_allowable_error>1000</max_allowable_error>
			</RCNLCostTerm>
			<RCNLCostTerm>
				<type>joint_jerk_minimization</type>
				<coordinate>pelvis_tx</coordinate>
				<is_enabled>true</is_enabled>
				<max_allowable_error>1000</max_allowable_error>
			</RCNLCostTerm>
			<RCNLCostTerm>
				<type>joint_jerk_minimization</type>
				<coordinate>pelvis_ty</coordinate>
				<is_enabled>true</is_enabled>
				<max_allowable_error>1000</max_allowable_error>
			</RCNLCostTerm>
			<RCNLCostTerm>
				<type>joint_jerk_minimization</type>
				<coordinate>pelvis_tz</coordinate>
				<is_enabled>true</is_enabled>
				<max_allowable_error>1000</max_allowable_error>
			</RCNLCostTerm>
			<RCNLCostTerm>
				<type>joint_jerk_minimization</type>
				<coordinate>hip_flexion_r</coordinate>
				<is_enabled>true</is_enabled>
				<max_allowable_error>5000</max_allowable_error>
			</RCNLCostTerm>
			<RCNLCostTerm>
				<type>joint_jerk_minimization</type>
				<coordinate>hip_adduction_r</coordinate>
				<is_enabled>true</is_enabled>
				<max_allowable_error>5000</max_allowable_error>
			</RCNLCostTerm>
			<RCNLCostTerm>
				<type>joint_jerk_minimization</type>
				<coordinate>hip_rotation_r</coordinate>
				<is_enabled>true</is_enabled>
				<max_allowable_error>1000</max_allowable_error>
			</RCNLCostTerm>
			<RCNLCostTerm>
				<type>joint_jerk_minimization</type>
				<coordinate>knee_angle_r</coordinate>
				<is_enabled>true</is_enabled>
				<max_allowable_error>5000</max_allowable_error>
			</RCNLCostTerm>
			<RCNLCostTerm>
				<type>joint_jerk_minimization</type>
				<coordinate>ankle_angle_r</coordinate>
				<is_enabled>true</is_enabled>
				<max_allowable_error>5000</max_allowable_error>
			</RCNLCostTerm>
			<RCNLCostTerm>
				<type>joint_jerk_minimization</type>
				<coordinate>subtalar_angle_r</coordinate>
				<is_enabled>true</is_enabled>
				<max_allowable_error>1000</max_allowable_error>
			</RCNLCostTerm>
			<RCNLCostTerm>
				<type>joint_jerk_minimization</type>
				<coordinate>mtp_angle_r</coordinate>
				<is_enabled>true</is_enabled>
				<max_allowable_error>1000</max_allowable_error>
			</RCNLCostTerm>
		</RCNLCostTermSet>
		<RCNLPathConstraintTerms>
			<RCNLConstraintTermSet>
					<RCNLConstraintTerm>
						<type>muscle_model_moment_consistency</type>
						<load>hip_flexion_r_moment</load>
						<is_enabled>true</is_enabled>
						<max_error>0.1</max_error>
						<min_error>-0.1</min_error>
					</RCNLConstraintTerm>
					<RCNLConstraintTerm>
						<type>muscle_model_moment_consistency</type>
						<load>knee_angle_r_moment</load>
						<is_enabled>true</is_enabled>
						<max_error>0.1</max_error>
						<min_error>-0.1</min_error>
					</RCNLConstraintTerm>
					<RCNLConstraintTerm>
						<type>muscle_model_moment_consistency</type>
						<load>ankle_angle_r_moment</load>
						<is_enabled>true</is_enabled>
						<max_error>0.1</max_error>
						<min_error>-0.1</min_error>
					</RCNLConstraintTerm>
			</RCNLConstraintTermSet>
		</RCNLPathConstraintTerms>
		<RCNLTerminalConstraintTerms>
			<RCNLConstraintTermSet>
				<RCNLConstraintTerm>
					<type>final_state_position</type>
					<target_error>0.278</target_error>
					<is_enabled>true</is_enabled>
					<coordinate>pelvis_tilt</coordinate>
					<max_error>0.01</max_error>
					<min_error>-0.01</min_error>
				</RCNLConstraintTerm>
				<RCNLConstraintTerm>
					<type>final_state_position</type>
					<target_error>-0.215</target_error>
					<is_enabled>true</is_enabled>
					<coordinate>pelvis_list</coordinate>
					<max_error>0.01</max_error>
					<min_error>-0.01</min_error>
				</RCNLConstraintTerm>
				<RCNLConstraintTerm>
					<type>final_state_position</type>
					<target_error>-0.255</target_error>
					<is_enabled>true</is_enabled>
					<coordinate>pelvis_rotation</coordinate>
					<max_error>0.01</max_error>
					<min_error>-0.01</min_error>
				</RCNLConstraintTerm>
				<RCNLConstraintTerm>
					<type>final_state_position</type>
					<target_error>0.264</target_error>
					<is_enabled>true</is_enabled>
					<coordinate>pelvis_tx</coordinate>
					<max_error>0.01</max_error>
					<min_error>-0.01</min_error>
				</RCNLConstraintTerm>
				<RCNLConstraintTerm>
					<type>final_state_position</type>
					<target_error>0.962</target_error>
					<is_enabled>true</is_enabled>
					<coordinate>pelvis_ty</coordinate>
					<max_error>0.01</max_error>
					<min_error>-0.01</min_error>
				</RCNLConstraintTerm>
				<RCNLConstraintTerm>
					<type>final_state_position</type>
					<target_error>0.054</target_error>
					<is_enabled>true</is_enabled>
					<coordinate>pelvis_tz</coordinate>
					<max_error>0.01</max_error>
					<min_error>-0.01</min_error>
				</RCNLConstraintTerm>
				<RCNLConstraintTerm>
					<type>final_state_position</type>
					<target_error>0.382</target_error>
					<is_enabled>true</is_enabled>
					<coordinate>hip_flexion_r</coordinate>
					<max_error>0.01</max_error>
					<min_error>-0.01</min_error>
				</RCNLConstraintTerm>
				<RCNLConstraintTerm>
					<type>final_state_position</type>
					<target_error>-0.221</target_error>
					<is_enabled>true</is_enabled>
					<coordinate>hip_adduction_r</coordinate>
					<max_error>0.01</max_error>
					<min_error>-0.01</min_error>
				</RCNLConstraintTerm>
				<RCNLConstraintTerm>
					<type>final_state_position</type>
					<target_error>0.055</target_error>
					<is_enabled>true</is_enabled>
					<coordinate>hip_rotation_r</coordinate>
					<max_error>0.01</max_error>
					<min_error>-0.01</min_error>
				</RCNLConstraintTerm>
				<RCNLConstraintTerm>
					<type>final_state_position</type>
					<target_error>1.057</target_error>
					<is_enabled>true</is_enabled>
					<coordinate>knee_angle_r</coordinate>
					<max_error>0.01</max_error>
					<min_error>-0.01</min_error>
				</RCNLConstraintTerm>
				<RCNLConstraintTerm>
					<type>final_state_position</type>
					<target_error>-0.547</target_error>
					<is_enabled>true</is_enabled>
					<coordinate>ankle_angle_r</coordinate>
					<max_error>0.01</max_error>
					<min_error>-0.01</min_error>
				</RCNLConstraintTerm>
				<RCNLConstraintTerm>
					<type>final_state_position</type>
					<target_error>-0.299</target_error>
					<is_enabled>true</is_enabled>
					<coordinate>subtalar_angle_r</coordinate>
					<max_error>0.01</max_error>
					<min_error>-0.01</min_error>
				</RCNLConstraintTerm>
				<RCNLConstraintTerm>
					<type>final_state_position</type>
					<target_error>0.338</target_error>
					<is_enabled>true</is_enabled>
					<coordinate>mtp_angle_r</coordinate>
					<max_error>0.01</max_error>
					<min_error>-0.01</min_error>
				</RCNLConstraintTerm>
			</RCNLConstraintTermSet>
		</RCNLTerminalConstraintTerms>
		<!--*Optional* list prefix of the data file, if left blank, use prefix from IK folder-->
		<trial_prefix></trial_prefix>
		<epsilon>1e-4</epsilon>
  		<!--*Optional* The vMaxFactor to use-->
        <v_max_factor>50</v_max_factor>
    </DesignOptimizationTool>
</NMSMPipelineDocument>
